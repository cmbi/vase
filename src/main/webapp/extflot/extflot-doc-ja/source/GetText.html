<html>
<head>
<title>The source code</title>
<link href="../resources/prettify/prettify.css" type="text/css"
	rel="stylesheet" />
<script type="text/javascript" src="../resources/prettify/prettify.js"></script>
</head>
<body onload="prettyPrint();">
	<pre class="prettyprint lang-js">/* $Id: GetText.js 3522 2009-02-26 06:11:28Z suzuki $
 * vim:sw=2:ts=8:sts=2:et:ft=javascript
 *
 * �ʲ������Ҽڤ��ơ�prototype.js ��¸���� Ext ��¸�ˤ��ޤ�����
 * http://blog.bz2.jp/archives/2006/05/javascript-5.html 
 *
 * ��������bindTextDomain ����Ѥ��ƥ����Ф���ưŪ�˼���������
 * ľ�� <domain>.js �򥤥󥯥롼�ɤ� setText ���Ѥ�����ϡ�
 * Ext ��ɬ�פ���ޤ���
 */

<div id="cls-Locale"></div>/**
 * @class Locale
 * �?��������륪�֥�������
 * ���٤� 1 �Ĥθ��줷�����ѤǤ��ޤ���
 * @singleton
 * @constructor
 */
Locale = new (function() {

	<div id="prop-Locale-LC_COLLATE"></div>/**
   * @property LC_COLLATE
   * @type String
	 * �?���������Ķ��ѿ�
   */
  this.LC_COLLATE  = 'C';
  <div id="prop-Locale-LC_CTYPE"></div>/**
   * @property LC_CTYPE
   * @type String
	 * �?���������Ķ��ѿ�
   */
  this.LC_CTYPE    = 'C';
  <div id="prop-Locale-LC_MESSAGES"></div>/**
   * @property LC_MESSAGES
   * @type String
	 * �?���������Ķ��ѿ�
   */
  this.LC_MESSAGES = 'C';
  <div id="prop-Locale-LC_MONETARY"></div>/**
   * @property LC_MONETARY
   * @type String
	 * �?���������Ķ��ѿ�
   */
  this.LC_MONETARY = 'C';
  <div id="prop-Locale-LC_NUMERIC"></div>/**
   * @property LC_NUMERIC
   * @type String
	 * �?���������Ķ��ѿ�
   */
  this.LC_NUMERIC  = 'C';
  <div id="prop-Locale-LC_TIME"></div>/**
   * @property LC_TIME
   * @type String
	 * �?���������Ķ��ѿ�
	 */
  this.LC_TIME     = 'C';

	<div id="prop-Locale-suffix"></div>/**
	 * @property suffix
	 * @type suffix
	 * json �����줿 po �ե�����γ�ĥ��
	 */
  this.suffix = 'json';

	// private ��å������Υϥå���
  this._messages = {};

	<div id="method-Locale-setLocale"></div>/**
	 * �?��������ꤹ�롣
   * bindTextDomain �ǻȤ��ޤ���
	 * @param {String} category ���åȤ��륫�ƥ���
	 * @param {String} locale   ���åȤ���?����
   * @return {String} ���åȤ����?����
	 */
  this.setLocale = function(category, locale) {
    switch (category) {
    case 'LC_ALL':
      this['LC_COLLATE']  = locale;
      this['LC_CTYPE']    = locale;
      this['LC_MESSAGES'] = locale;
      this['LC_MONETARY'] = locale;
      this['LC_NUMERIC']  = locale;
      this['LC_TIME']     = locale;
      break;
    case 'LC_COLLATE':
    case 'LC_CTYPE':
    case 'LC_MESSAGES':
    case 'LC_MONETARY':
    case 'LC_NUMERIC':
    case 'LC_TIME':
      this[category] = locale;
      break;
    default:
      return false;
    }
    return locale;
  };

	<div id="method-Locale-setSuffix"></div>/**
	 * �?����ե�����γ�ĥ�Ҥ����ꤹ��
	 * @param {String} suffix ���ꤹ�뿷������ĥ��
	 */
  this.setSuffix = function(suffix) {
    this.suffix = suffix;
  };

	<div id="method-Locale-bindTextDomain"></div>/**
	 * �?����ե�������ɤ߹���
	 * <pre>
			<directory>/<locale>/LC_MESSAGES/<domain>.<suffix>
		
		</pre>
   * TODO ư���Ƥޤ���
   *      �?�������������ˡ�������򹹿��������ɬ�פǤ���
   *      �Ǥ�ñ���ȯ�ۤ��� _() �θƤӽФ����򤹤٤ƥϥå���˵������Ƥ����ơ�
   *      ������ƹ������롢�Ȥ��������ˤʤ�櫓�Ǥ�����
   *      ������ȥ��٥�Ȥ���������ۤ����褤�褦�ʵ��⤷�ޤ�������
   *      ������ˤ��褫�ʤ���ɤ�����
	 * @param {domain}    domain �ɤ߹���?����ɥᥤ��
	 * @param {directory} directory �ɤ߹��� URL
	 */
  this.bindTextDomain = function(domain, directory) {
    this._messages = {};
    url = directory+'/'+this.LC_MESSAGES+'/LC_MESSAGES/'+domain+'.'+this.suffix;

    // �̿��ˤ� Ext �� ScriptTagProxy ��Ȥ���
    // �ǡ�����ñ��� [[<en>, <ja>], ...] ������Ǥ����Ȥꡢ�ϥå�����Ѵ�����
    var proxy = new Ext.data.ScriptTagProxy({url: url});
    proxy.on('loadexception', function(me, obj, res, err) {
      // TODO proxy ��夫���餦��
      console.log(err);
    });
    proxy.load({}, new Ext.data.ArrayReader(), function(ret, arg, success) {
      if (success) {
        var records = ret.records;
        for (var i = 0, len = records.length; i < len; i++) {
          var rec = records[i];
          this._messages[rec.get(0)] = rec.get(1);
        }
      }
    }, this);
  };

  <div id="method-Locale-setText"></div>/**
   * �?����ϥå������Ͽ����
   * Ʊ��Υ�����ɤ����ä����ϡ���񤭤���ޤ���
   * �̾�� <pre>
			<locale>/LC_MESSAGES/<domain>.js
		
		</pre> ��ǸƤӽФ���ޤ���
   * @param {String} locale_array [[<en>, <locale_text>], ...] ������
   * @param {String/Array} locale ���åȤ������
   * @return {Bool} ��Ͽ���줿��
   */
  this.setText = function(locale_array, locale) {
    var lang = navigator.language || navigator.userLanguage || navigator.systemLanguage;
    if (typeof locale == "string") { locale = locale.split(','); }
    if (typeof locale != "undefined" && typeof locale.indexOf == "function" && locale.indexOf(lang) < 0) { return false; }
    for (var i = 0, len = locale_array.length; i < len; i++) {
      var loc = locale_array[i];
      this._messages[loc[0]] = loc[1];
    }
    return true;
  };

	<div id="method-Locale-getText"></div>/**
	 * ��������
	 * �ϥå���������Ǥ���
   * @param {String} str ������ʸ����
   * @return {String} ������ʸ����
	 */
  this.getText = function(str) {
    return this._messages[str] || str;
  };

	<div id="method-Locale-getTextNoop"></div>/**
	 * ���������Ͽ����
	 * gettext ����ѥ�����ˤΤ��Ѥ����ºݤ������� getText �ˤƹԤ��ޤ���
   * @param {String} str GetText ����Ͽ���륭�����
   * @return {String} ��Ͽ���줿�������
	 */
  this.getTextNoop = function(str) {
    return str;
  };
})();

<div id="method-Locale-_"></div>/**
 * ����Ū�� gettext �Υ����ꥢ��
 * �������롣
 * @param {String} ������ʸ����
 * @return {String} ������ʸ����
 */
_ = function(str) { return Locale.getText(str); };

<div id="method-Locale-N_"></div>/**
 * ����Ū�� gettext �Υ����ꥢ��
 * ����������ɤ��������������������Τ�ΤϤ��ʤ���
 * @param {String} ��Ͽ���륭�����
 * @return {String} ��Ͽ�奭�����
 */
N_ = function(str) { return Locale.getTextNoop(str); };

	
	</pre>
</body>
</html>